# [리눅스] Bash trap 사용법

## نظرة عامة
أمر `trap` في Bash يُستخدم للتعامل مع إشارات النظام (signals) والأحداث (events) التي قد تحدث أثناء تنفيذ سكربت. الغرض الأساسي من هذا الأمر هو السماح للمستخدم بتحديد إجراءات معينة يتم تنفيذها عند تلقي إشارات معينة، مثل إنهاء السكربت أو تلقي إشارة توقف. هذا يمكن أن يكون مفيدًا لتنظيف الموارد أو حفظ الحالة قبل إنهاء السكربت.

## الاستخدام
التركيب الأساسي لأمر `trap` هو كما يلي:

```bash
trap COMMAND SIGNAL
```

### الخيارات الشائعة:
- `COMMAND`: الأمر أو الأوامر التي تريد تنفيذها عند تلقي الإشارة.
- `SIGNAL`: الإشارة التي تريد التقاطها، مثل `SIGINT` (التي تُرسل عند الضغط على Ctrl+C) أو `SIGTERM` (التي تُستخدم لإنهاء العمليات).

يمكنك أيضًا استخدام `EXIT` للإشارة إلى تنفيذ الأمر عند انتهاء السكربت.

## أمثلة
### مثال 1: التقاط إشارة إنهاء
في هذا المثال، سنستخدم `trap` لتنظيف الملفات المؤقتة عند إنهاء السكربت:

```bash
#!/bin/bash

trap 'rm -f /tmp/tempfile; echo "تم حذف الملفات المؤقتة."' EXIT

# إنشاء ملف مؤقت
touch /tmp/tempfile

# تنفيذ بعض العمليات
echo "السكربت قيد التشغيل..."
sleep 10
echo "السكربت انتهى."
```

### مثال 2: التقاط إشارة Ctrl+C
في هذا المثال، سنستخدم `trap` لعرض رسالة مخصصة عند الضغط على Ctrl+C:

```bash
#!/bin/bash

trap 'echo "تم إلغاء السكربت بواسطة المستخدم."; exit' SIGINT

# حلقة لا نهائية
while true; do
    echo "السكربت قيد التشغيل... اضغط Ctrl+C للإلغاء."
    sleep 2
done
```

## نصائح
- تأكد من استخدام `trap` في بداية السكربت لضمان التقاط الإشارات بشكل صحيح.
- استخدم `trap` مع `EXIT` لتنظيف الموارد أو حفظ الحالة عند انتهاء السكربت.
- اختبر السكربتات الخاصة بك للتأكد من أن الأوامر المحددة في `trap` تعمل كما هو متوقع عند تلقي الإشارات.