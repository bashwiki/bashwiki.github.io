# [리눅스] Bash trap 사용법

## Обзор
Команда `trap` в Bash используется для определения действий, которые должны выполняться при получении определенных сигналов или при завершении выполнения скрипта. Это позволяет разработчикам обрабатывать события, такие как прерывание выполнения скрипта пользователем или завершение работы скрипта по другим причинам. Основная цель `trap` — обеспечить корректное завершение работы скрипта и выполнение необходимых очистительных действий.

## Использование
Основной синтаксис команды `trap` выглядит следующим образом:

```bash
trap COMMAND SIGNAL
```

- `COMMAND` — это команда или набор команд, которые будут выполнены при получении указанного сигнала.
- `SIGNAL` — это сигнал, который будет перехвачен. Сигналы могут быть указаны как имена (например, `SIGINT`, `SIGTERM`) или как номера (например, `2`, `15`).

Некоторые распространенные сигналы:
- `SIGINT` (2) — прерывание (обычно вызвано Ctrl+C).
- `SIGTERM` (15) — запрос на завершение.
- `EXIT` — выполняется при выходе из скрипта.

## Примеры
### Пример 1: Обработка SIGINT
В этом примере мы используем `trap` для обработки сигнала прерывания (SIGINT), чтобы вывести сообщение перед завершением скрипта.

```bash
#!/bin/bash

trap 'echo "Скрипт прерван"; exit' SIGINT

while true; do
    echo "Работаю... Нажмите Ctrl+C для выхода."
    sleep 1
done
```

### Пример 2: Очистка ресурсов при выходе
В этом примере мы используем `trap` для выполнения очистки ресурсов при выходе из скрипта.

```bash
#!/bin/bash

trap 'echo "Очистка ресурсов..."; rm -f /tmp/tempfile' EXIT

echo "Создание временного файла..."
touch /tmp/tempfile

# Основная логика скрипта
echo "Скрипт выполняется..."
sleep 5
echo "Скрипт завершен."
```

## Советы
- Используйте `trap` для обработки сигналов, чтобы избежать потери данных или некорректного завершения работы скрипта.
- Убедитесь, что команды, указанные в `trap`, выполняются быстро, чтобы не блокировать выполнение скрипта.
- Тестируйте обработку сигналов, чтобы убедиться, что скрипт корректно реагирует на прерывания и завершения.
- Используйте `trap` с сигналом `EXIT`, чтобы выполнить очистку ресурсов независимо от того, как завершился скрипт.